{"version":3,"file":"lazyload.js","sources":["../../src/lib.js","../../src/modules/lazyload.js"],"sourcesContent":["export function addClass (el, list = []) {\n    if (!Array.isArray(list)) list = [list]\n\n    list.forEach(clz => (!el.classList.contains(clz) && el.classList.add(clz)))\n}\n\nexport function removeClass (el, list = []) {\n    if (!Array.isArray(list)) list = [list]\n\n    list.forEach(clz => (el.classList.contains(clz) && el.classList.remove(clz)))\n}\n\nexport function attachListener (el, evtName, handler, opts) {\n    el.addEventListener(evtName, handler, opts)\n}\n\nexport function detachListener (el, evtName, handler) {\n    el.removeEventListener(evtName, handler)\n}\n\nexport function removeAttr (el, attr) {\n    el.removeAttribute(attr)\n}\n\nexport function detectTouch () {\n    return Boolean(\n        'ontouchstart' in window\n        || navigator.maxTouchPoints > 0\n        || navigator.msMaxTouchPoints > 0\n        || window.DocumentTouch && document instanceof DocumentTouch\n    )\n}\n\n/**\n * get Element transform\n * @param {HTMLElement} el\n * @param {Boolean} isHorizontal\n * @returns {Number}\n */\nexport function getTranslate (el, isHorizontal) {\n    const matrix = getComputedStyle(el).transform.replace(/[a-z]|\\(|\\)|\\s/g, '').split(',').map(parseFloat)\n    let arr\n\n    if (matrix.length === 16) {\n        arr = matrix.slice(12, 14)\n    } else if (matrix.length === 6) {\n        arr = matrix.slice(4, 6)\n    }\n    return arr[isHorizontal ? 0 : 1] || 0\n}\n","import {\n    addClass,\n    removeClass\n} from '../lib.js'\n\n/**\n * TinySwiper plugin for image lazy loading.\n *\n * @param {*} tinyswiper\n */\nexport default function SwiperPluginLazyload (instance) {\n    const { config } = instance\n\n    if (!config.lazyload) return\n\n    instance.lazyload = {\n        load (index) {\n            const $slide = instance.$list[index]\n\n            if (!$slide) return\n\n            const $imgs = [].slice.call($slide.getElementsByClassName(config.lazyload.elementClass))\n            const $preloaders = [].slice.call($slide.getElementsByClassName(config.lazyload.preloaderClass))\n\n            function handleLoaded ($img) {\n                $img.removeAttribute('data-src')\n                addClass($img, [config.lazyload.loadedClass])\n                removeClass($img, [config.lazyload.loadingClass])\n                $img.onloaded = null\n                $img.onerror = null\n                $img.isLoaded = true\n\n                if ($imgs.every(item => item.isLoaded)) {\n                    $preloaders.forEach($preloader => {\n                        $preloader.parentElement.removeChild($preloader)\n                    })\n                }\n            }\n\n            $imgs.forEach($img => {\n                if (!$img.hasAttribute('data-src')) return\n\n                const src = $img.getAttribute('data-src')\n\n                addClass($img, [config.lazyload.loadingClass])\n                removeClass($img, [config.lazyload.loadedClass])\n                $img.src = src\n                $img.onload = () => handleLoaded($img)\n                $img.onerror = () => handleLoaded($img)\n            })\n        },\n\n        loadRange (index, range) {\n            instance.lazyload.load(index)\n\n            if (config.lazyload.loadPrevNext && range >= 1) {\n                for (let i = 1; i <= range; i++) {\n                    instance.lazyload.load(index + i)\n                    instance.lazyload.load(index - i)\n                }\n            }\n        }\n    }\n\n    instance.on('before-init', () => {\n        config.lazyload = {\n            loadPrevNext: false,\n            loadPrevNextAmount: 1,\n            loadOnTransitionStart: false,\n            elementClass: 'swiper-lazy',\n            loadingClass: 'swiper-lazy-loading',\n            loadedClass: 'swiper-lazy-loaded',\n            preloaderClass: 'swiper-lazy-preloader',\n            ...config.lazyload\n        }\n    })\n\n    if (config.lazyload.loadOnTransitionStart) {\n        instance.on('before-slide', function (oldIndex, tinyswiper, newIndex) {\n            tinyswiper.lazyload.loadRange(newIndex, config.lazyload.loadPrevNextAmount)\n        })\n    } else {\n        instance.on('after-slide', function (index, tinyswiper) {\n            tinyswiper.lazyload.loadRange(index, config.lazyload.loadPrevNextAmount)\n        })\n    }\n\n    instance.on('after-destroy', tinyswiper => {\n        if (!tinyswiper.config.lazyload) return\n\n        delete tinyswiper.lazyload\n    })\n}\n"],"names":["addClass","el","list","Array","isArray","forEach","clz","classList","contains","add","removeClass","remove","SwiperPluginLazyload","instance","config","lazyload","load","index","$slide","$list","$imgs","slice","call","getElementsByClassName","elementClass","$preloaders","preloaderClass","handleLoaded","$img","removeAttribute","loadedClass","loadingClass","onloaded","onerror","isLoaded","every","item","$preloader","parentElement","removeChild","hasAttribute","src","getAttribute","onload","loadRange","range","loadPrevNext","i","on","loadPrevNextAmount","loadOnTransitionStart","oldIndex","tinyswiper","newIndex"],"mappings":"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"}